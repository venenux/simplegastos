' Gambas class file

'' objeto de configuracion de datos
Private $appsettings As Settings
'' modo de trabajo de la apicacion, si esta correindo en entorno produccion o no
Private produccion As Boolean = False

'' al instanciar la clase se ajusta y configura las conecciones y configuraciones por defecto
Public Sub _new(Optional esproduccion As Boolean = False)
    
    produccion = esproduccion       ' en desarrollo para trabajar independiente se usa sqlite e incluso se recrea la db
    If produccion Then
        $appsettings = New Settings(User.Home &/ ".config/simplegastos" &/ Application.Name & ".conf")
    Else
        $appsettings = New Settings(Application.Path &/ "../../sysgatosmisc/" &/ Application.Name & ".conf")
    Endif
    
End


Public Sub Form_Open()
'mostrar el formulario con su propósito
  Me.Center
  Me.Caption = "INICIAR SESIÓN"
  produccion = $appsettings["datosapp/esproduccion", False]         ' cambiar a true o usar el archivo de configuracion
End

''determinar quien es y establecer variables de usuario y clave, si existen, hubo acceso positivo
Public Sub btnformloginok_Click()

  Dim login, password As String
  Dim contain As New Containerdataoasis(produccion)
  Dim rs As Collection  


  If IsNull(informloginUsername.Text) Or IsNull(informloginUserpass.Text) Then
    Message.Warning("¡No deje ningún cuadro vacío!")
  Else
       ' credenciales(Optional ulogin As String = "", Optional uclave As String = "", Optional ubicacion As String = "") As Collection
       rs = contain.credenciales(informloginUsername.Text, informloginUserpass.Text)
        If Val(rs["resultado"]) = 1 Then
          MMain.userdata = rs
        Endif
  Endif    
End

Public Sub btnformloginCancel_Click()
  
  Me.Close
  
End

Public Sub informloginUsername_KeyPress()
  
  If (key.Code = 65421 Or Key.Code = Key.Return) Then
    informloginUserpass.SetFocus
  Endif     
  
End

Public Sub informloginUserpass_KeyPress()
  
  If (key.Code = 65421 Or Key.Code = Key.Return) Then
    btnformloginok_Click
  Endif
  
End
